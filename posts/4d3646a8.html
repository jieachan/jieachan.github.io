<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>docker系列-docker.sock探究 | 小C的博客</title><meta name="author" content="mrxccc,mrxccc@qq.com"><meta name="copyright" content="mrxccc"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><meta name="description" content="预备知识搞清楚&#x2F;var&#x2F;run&#x2F;docker.sock参数的前提是了解docker的client+server架构，如下图  可见在电脑上运行的docker由client和server组成，我们输入docker version命令实际上是通过客户端将请求发送到同一台电脑上的Doceker Daemon服务，由Docker Daemon返回信息，客户端收到信息后展示在控制台上。 可是这个又跟dock">
<meta property="og:type" content="article">
<meta property="og:title" content="docker系列-docker.sock探究">
<meta property="og:url" content="https://blog.mrxccc.cn/posts/4d3646a8.html">
<meta property="og:site_name" content="小C的博客">
<meta property="og:description" content="预备知识搞清楚&#x2F;var&#x2F;run&#x2F;docker.sock参数的前提是了解docker的client+server架构，如下图  可见在电脑上运行的docker由client和server组成，我们输入docker version命令实际上是通过客户端将请求发送到同一台电脑上的Doceker Daemon服务，由Docker Daemon返回信息，客户端收到信息后展示在控制台上。 可是这个又跟dock">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg">
<meta property="article:published_time" content="2020-10-23T09:31:44.000Z">
<meta property="article:modified_time" content="2020-11-25T06:58:49.574Z">
<meta property="article:author" content="mrxccc">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://blog.mrxccc.cn/posts/4d3646a8"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//hm.baidu.com"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="preconnect" href="//zz.bdstatic.com"/><meta name="baidu-site-verification" content="code-ZYlyntZWB3"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?f3cd205d77b1f8852942d09861436b1c";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":1,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":50,"languages":{"author":"作者: mrxccc","link":"链接: ","source":"来源: 小C的博客","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  ClickShowText: undefined,
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#2d3035","position":"bottom-left"},
  justifiedGallery: {
    js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
    css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
};

var saveToLocal = {
  set: function setWithExpiry(key, value, ttl) {
    const now = new Date()
    const expiryDay = ttl * 86400000
    const item = {
      value: value,
      expiry: now.getTime() + expiryDay,
    }
    localStorage.setItem(key, JSON.stringify(item))
  },

  get: function getWithExpiry(key) {
    const itemStr = localStorage.getItem(key)

    if (!itemStr) {
      return undefined
    }
    const item = JSON.parse(itemStr)
    const now = new Date()

    if (now.getTime() > item.expiry) {
      localStorage.removeItem(key)
      return undefined
    }
    return item.value
  }
}</script><script id="config_change">var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2020-11-25 14:58:49'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(function () {  window.activateDarkMode = function () {
    document.documentElement.setAttribute('data-theme', 'dark')
    if (document.querySelector('meta[name="theme-color"]') !== null) {
      document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
    }
  }
  window.activateLightMode = function () {
    document.documentElement.setAttribute('data-theme', 'light')
   if (document.querySelector('meta[name="theme-color"]') !== null) {
      document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
    }
  }
  const autoChangeMode = 'false'
  const t = saveToLocal.get('theme')
  if (autoChangeMode === '1') {
    const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
    const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
    const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
    const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified
    if (t === undefined) {
      if (isLightMode) activateLightMode()
      else if (isDarkMode) activateDarkMode()
      else if (isNotSpecified || hasNoSupport) {
        const now = new Date()
        const hour = now.getHours()
        const isNight = hour <= 6 || hour >= 18
        isNight ? activateDarkMode() : activateLightMode()
      }
      window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
        if (saveToLocal.get('theme') === undefined) {
          e.matches ? activateDarkMode() : activateLightMode()
        }
      })
    } else if (t === 'light') activateLightMode()
    else activateDarkMode()
  } else if (autoChangeMode === '2') {
    const now = new Date()
    const hour = now.getHours()
    const isNight = hour <= 6 || hour >= 18
    if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
    else if (t === 'light') activateLightMode()
    else activateDarkMode()
  } else {
    if (t === 'dark') activateDarkMode()
    else if (t === 'light') activateLightMode()
  }const asideStatus = saveToLocal.get('aside-status')
if (asideStatus !== undefined) {
   if (asideStatus === 'hide') {
     document.documentElement.classList.add('hide-aside')
   } else {
     document.documentElement.classList.remove('hide-aside')
   }
}})()</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><meta name="generator" content="Hexo 5.2.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="author-avatar"><img class="avatar-img" src="/null" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">文章</div><div class="length-num">19</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">分类</div><div class="length-num">6</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg)"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">小C的博客</a></span><span id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><span class="close" id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></span></span></nav><div id="post-info"><h1 class="post-title">docker系列-docker.sock探究</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2020-10-23T09:31:44.000Z" title="发表于 2020-10-23 17:31:44">2020-10-23</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2020-11-25T06:58:49.574Z" title="更新于 2020-11-25 14:58:49">2020-11-25</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/docker/">docker</a></span></div><div class="meta-secondline"> <span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">2.2k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>9分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="预备知识"><a href="#预备知识" class="headerlink" title="预备知识"></a>预备知识</h1><p>搞清楚/var/run/docker.sock参数的前提是了解docker的client+server架构，如下图</p>
<p><img src="/img/docker-cli-server.png"></p>
<p>可见在电脑上运行的docker由client和server组成，我们输入docker version命令实际上是通过客户端将请求发送到同一台电脑上的Doceker Daemon服务，由Docker Daemon返回信息，客户端收到信息后展示在控制台上。</p>
<p><strong>可是这个又跟docker.sock有什么关系呢？别急，我们再了解一下docker一些比较重要的组件</strong></p>
<h1 id="Docker-的主要组件"><a href="#Docker-的主要组件" class="headerlink" title="Docker 的主要组件"></a>Docker 的主要组件</h1><p>安装 docker ，其实是安装了 docker 客户端、dockerd 等一系列的组件，其中比较重要的有下面几个。</p>
<p><strong>Docker CLI(docker)</strong><br>docker 程序是一个客户端工具，用来把用户的请求发送给 docker daemon(dockerd)。</p>
<p>该程序的安装路径为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;usr&#x2F;bin&#x2F;docker</span><br></pre></td></tr></table></figure>

<p><strong>Dockerd</strong><br>docker daemon(dockerd)，一般也会被称为 docker engine。</p>
<p>该程序的安装路径为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;usr&#x2F;bin&#x2F;dockerd</span><br></pre></td></tr></table></figure>

<p><strong>Containerd</strong><br>在宿主机中管理完整的容器生命周期：容器镜像的传输和存储、容器的执行和管理、存储和网络等。</p>
<p>该程序的安装路径为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;usr&#x2F;bin&#x2F;docker-containerd</span><br></pre></td></tr></table></figure>

<p><strong>Containerd-shim</strong><br>它是 containerd 的组件，是容器的运行时载体，主要是用于剥离 containerd 守护进程与容器进程，引入shim，允许runc 在创建和运行容器之后退出，并将 shim 作为容器的父进程，而不是 containerd 作为父进程，这样做的目的是当 containerd 进程挂掉，由于 shim 还正常运行，因此可以保证容器不受影响。此外，shim 也可以收集和报告容器的退出状态，不需要 containerd 来 wait 容器进程。我们在 docker 宿主机上看到的 shim 也正是代表着一个个通过调用 containerd 启动的 docker 容器。</p>
<p>该程序的安装路径为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;usr&#x2F;bin&#x2F;docker-containerd-shim</span><br></pre></td></tr></table></figure>

<p><strong>RunC</strong><br>RunC 是一个轻量级的工具，它是用来运行容器的，容器作为 runC 的子进程开启，在不需要运行一个 Docker daemon 的情况下可以嵌入到其他各种系统，也就是说可以不用通过 docker 引擎，直接运行容器。docker是通过Containerd调用 runC 运行容器的</p>
<p>该程序的安装路径为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;usr&#x2F;bin&#x2F;docker-runc</span><br></pre></td></tr></table></figure>

<p><img src="/img/docker-component.png"></p>
<h1 id="从-hello-world-开始"><a href="#从-hello-world-开始" class="headerlink" title="从 hello world 开始"></a>从 hello world 开始</h1><p>我们通过hello-world镜像分析来进行：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[vagrant@docker-host docker]$ docker run hello-world</span><br><span class="line"></span><br><span class="line">Hello from Docker!</span><br><span class="line">This message shows that your installation appears to be working correctly.</span><br><span class="line"></span><br><span class="line">To generate this message, Docker took the following steps:</span><br><span class="line"> 1. The Docker client contacted the Docker daemon.</span><br><span class="line"> 2. The Docker daemon pulled the &quot;hello-world&quot; image from the Docker Hub.</span><br><span class="line">    (amd64)</span><br><span class="line"> 3. The Docker daemon created a new container from that image which runs the</span><br><span class="line">    executable that produces the output you are currently reading.</span><br><span class="line"> 4. The Docker daemon streamed that output to the Docker client, which sent it</span><br><span class="line">    to your terminal.</span><br><span class="line"></span><br><span class="line">To try something more ambitious, you can run an Ubuntu container with:</span><br><span class="line"> $ docker run -it ubuntu bash</span><br><span class="line"></span><br><span class="line">Share images, automate workflows, and more with a free Docker ID:</span><br><span class="line"> https:&#x2F;&#x2F;hub.docker.com&#x2F;</span><br><span class="line"></span><br><span class="line">For more examples and ideas, visit:</span><br><span class="line"> https:&#x2F;&#x2F;docs.docker.com&#x2F;get-started&#x2F;</span><br></pre></td></tr></table></figure>

<p>上面的输出信息指出，hello-world 容器的运行经历了如下四步：</p>
<ol>
<li>Docker 客户端向 docker daemon 发送请求</li>
<li>Docker daemon 从 Docker Hub 上拉取镜像</li>
<li>Docker daemon 使用镜像运行了一个容器并产生了输出</li>
<li>Docker daemon 把输出的内容发送给了 docker 客户端</li>
</ol>
<p>这是一个很抽象也很容器理解的过程，但是我们还想知道更多：docker daemon 是如何创建并运行容器的？<br>其实容器部分的操作和管理都被 dockerd 外包给 containerd 了，下图描述了运行一个容器时各个组件之间的关系：</p>
<p><img src="/img/dockerd.png"></p>
<h1 id="进入正题"><a href="#进入正题" class="headerlink" title="进入正题"></a>进入正题</h1><h2 id="Docker-Daemon-的连接方式"><a href="#Docker-Daemon-的连接方式" class="headerlink" title="Docker Daemon 的连接方式"></a>Docker Daemon 的连接方式</h2><ol>
<li><p><strong>UNIX 域套接字</strong></p>
<p>默认就是这种方式, 会生成一个 <code>/var/run/docker.sock</code> 文件, <code>UNIX</code> 域套接字用于本地进程之间的通讯, 这种方式相比于网络套接字效率更高, 但局限性就是只能被本地的客户端访问。</p>
</li>
<li><p><strong>tcp 端口监听</strong></p>
<p>服务端开启端口监听 <code>dockerd -H IP:PORT</code> , 客户端通过指定IP和端口访问服务端 <code>docker -H IP:PORT</code> 。通过这种方式, 任何人只要知道了你暴露的ip和端口就能随意访问你的docker服务了, 这是一件很危险的事, 因为docker的权限很高, 不法分子可以从这突破取得服务端宿主机的最高权限。</p>
</li>
</ol>
<h2 id="什么是unix-socket？"><a href="#什么是unix-socket？" class="headerlink" title="什么是unix socket？"></a>什么是unix socket？</h2><p>unix socket可以让一个程序通过类似处理一个文件的方式和另一个程序通信，这是一种进程间通信的方式（IPC）。<br> 当你在host上安装并且启动好docker，<code>docker daemon</code> 会自动创建一个socket文件并且保存在<code>/var/run/docker.sock</code>目录下。<code>docker daemon</code>监听着socket中即将到来的链接请求（可以通过<code>-H unix:///var/run/docker.sock</code>设定<code>docker daemon</code>监听的socket文件，-H参数还可以设定监听tcp:port或者其它的unix socket），当一个链接请求到来时，它会使用标准IO来读写数据。</p>
<p>docker.sock 是docker client 和docker daemon 在localhost进行通信的socket文件。<br> 可以直接call这个socket文件来拉去镜像，创建容器，启动容器等一系列操作。（其实就是直接call docker daemon API而不是通过docker client的方式去操控docker daemon）。</p>
<h2 id="官方说明"><a href="#官方说明" class="headerlink" title="官方说明"></a>官方说明</h2><p>我们从Docker Daemon进行，查看它的<a target="_blank" rel="noopener" href="https://docs.docker.com/v17.09/engine/reference/commandline/dockerd/#description">官方文档</a></p>
<p><img src="/img/dockerd-host.jpg"></p>
<p>上图是Docker Daemon的配置参数</p>
<p>翻译过来就是：–host=[]<code>指定Docker守护程序将在何处侦听客户端连接。如果未指定，则默认为/var/run/docker.sock</code></p>
<p>所以docker客户端只要把请求发往这里，daemon就能收到并且做出响应。</p>
<p>按照上面的解释来推理：我们也可以向<code>/var/run/docker.sock</code>发送请求，也能达到<code>docker ps</code>、<code>docker images</code>这样的效果；</p>
<h2 id="验证"><a href="#验证" class="headerlink" title="验证"></a>验证</h2><h3 id="1-查看镜像："><a href="#1-查看镜像：" class="headerlink" title="1.查看镜像："></a>1.查看镜像：</h3><ul>
<li><p>docker-cli方式：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[vagrant@docker-host ~]$ docker images</span><br><span class="line">REPOSITORY                             TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">spring_demo                            latest              b7c0355e0a01        6 days ago          151MB</span><br><span class="line">nginx                                  latest              f35646e83998        2 weeks ago         133MB</span><br><span class="line">hello-world                            latest              bf756fb1ae65        9 months ago        13.3kB</span><br><span class="line">ampregistry:5000&#x2F;sng-biz-base-alpine   2.1.0               54c2c81fffbe        17 months ago       137MB</span><br></pre></td></tr></table></figure>
</li>
<li><p>请求到Docker Daemon：</p>
<p>该请求返回的是json串，使用<code>| jq .</code>是为了格式化json,方便查看</p>
<blockquote>
<p>jq是linux里面的一个json格式化工具，如果没有安装可以去掉后面的<code>| jq .</code>代码，拷贝返回的json串手动格式化也可以</p>
</blockquote>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">[vagrant@docker-host ~]$ curl -s --unix-socket /var/run/docker.sock http:/images/json | jq .</span><br><span class="line">[</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">&quot;VirtualSize&quot;</span>: <span class="number">151316494</span>,</span><br><span class="line">    <span class="attr">&quot;Size&quot;</span>: <span class="number">151316494</span>,</span><br><span class="line">    <span class="attr">&quot;Containers&quot;</span>: <span class="number">-1</span>,</span><br><span class="line">    <span class="attr">&quot;Created&quot;</span>: <span class="number">1603359433</span>,</span><br><span class="line">    <span class="attr">&quot;Id&quot;</span>: <span class="string">&quot;sha256:b7c0355e0a01f296e6ac94071b19c227839c8c19fecb2376dd8677ecbbe48017&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;Labels&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">&quot;ParentId&quot;</span>: <span class="string">&quot;sha256:4a5e4dd8fb964affb9750f01f66fb5f381988fcdbf8928902ce3f77b14fe990a&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;RepoDigests&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">&quot;RepoTags&quot;</span>: [</span><br><span class="line">      <span class="string">&quot;spring_demo:latest&quot;</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">&quot;SharedSize&quot;</span>: <span class="number">-1</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">&quot;VirtualSize&quot;</span>: <span class="number">132861270</span>,</span><br><span class="line">    <span class="attr">&quot;Size&quot;</span>: <span class="number">132861270</span>,</span><br><span class="line">    <span class="attr">&quot;Containers&quot;</span>: <span class="number">-1</span>,</span><br><span class="line">    <span class="attr">&quot;Created&quot;</span>: <span class="number">1602578384</span>,</span><br><span class="line">    <span class="attr">&quot;Id&quot;</span>: <span class="string">&quot;sha256:f35646e83998b844c3f067e5a2cff84cdf0967627031aeda3042d78996b68d35&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;Labels&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;maintainer&quot;</span>: <span class="string">&quot;NGINX Docker Maintainers &lt;docker-maint@nginx.com&gt;&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">&quot;ParentId&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;RepoDigests&quot;</span>: [</span><br><span class="line">      <span class="string">&quot;nginx@sha256:ed7f815851b5299f616220a63edac69a4cc200e7f536a56e421988da82e44ed8&quot;</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">&quot;RepoTags&quot;</span>: [</span><br><span class="line">      <span class="string">&quot;nginx:latest&quot;</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">&quot;SharedSize&quot;</span>: <span class="number">-1</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">&quot;VirtualSize&quot;</span>: <span class="number">13336</span>,</span><br><span class="line">    <span class="attr">&quot;Size&quot;</span>: <span class="number">13336</span>,</span><br><span class="line">    <span class="attr">&quot;Containers&quot;</span>: <span class="number">-1</span>,</span><br><span class="line">    <span class="attr">&quot;Created&quot;</span>: <span class="number">1578014497</span>,</span><br><span class="line">    <span class="attr">&quot;Id&quot;</span>: <span class="string">&quot;sha256:bf756fb1ae65adf866bd8c456593cd24beb6a0a061dedf42b26a993176745f6b&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;Labels&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">&quot;ParentId&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;RepoDigests&quot;</span>: [</span><br><span class="line">      <span class="string">&quot;hello-world@sha256:8c5aeeb6a5f3ba4883347d3747a7249f491766ca1caa47e5da5dfcf6b9b717c0&quot;</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">&quot;RepoTags&quot;</span>: [</span><br><span class="line">      <span class="string">&quot;hello-world:latest&quot;</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">&quot;SharedSize&quot;</span>: <span class="number">-1</span></span><br><span class="line">  &#125;</span><br><span class="line">]</span><br><span class="line"></span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="2-查看容器："><a href="#2-查看容器：" class="headerlink" title="2.查看容器："></a>2.查看容器：</h3><p>先运行一个nginx容器：<code>docker run --name mynginx -p 80:80 -d nginx</code></p>
<ul>
<li><p>docker-cli方式：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED              STATUS              PORTS                NAMES</span><br><span class="line">919b34a22018        nginx               &quot;&#x2F;docker-entrypoint.…&quot;   About a minute ago   Up About a minute   0.0.0.0:80-&gt;80&#x2F;tcp   mynginx</span><br></pre></td></tr></table></figure>
</li>
<li><p>请求Docker Daemon:</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">[vagrant@docker-host ~]$ curl -s --unix-socket /var/run/docker.sock http:/containers/json | jq .</span><br><span class="line">[</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">&quot;Mounts&quot;</span>: [],</span><br><span class="line">    <span class="attr">&quot;NetworkSettings&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;Networks&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;bridge&quot;</span>: &#123;</span><br><span class="line">          <span class="attr">&quot;DriverOpts&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">          <span class="attr">&quot;MacAddress&quot;</span>: <span class="string">&quot;02:42:ac:11:00:02&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;GlobalIPv6PrefixLen&quot;</span>: <span class="number">0</span>,</span><br><span class="line">          <span class="attr">&quot;GlobalIPv6Address&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;IPv6Gateway&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;IPAMConfig&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">          <span class="attr">&quot;Links&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">          <span class="attr">&quot;Aliases&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">          <span class="attr">&quot;NetworkID&quot;</span>: <span class="string">&quot;89d9f74c2884582696971298095e85c9c7df332a356c4b3a4dc09807eb6d457f&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;EndpointID&quot;</span>: <span class="string">&quot;53d712df1ad9bd9093b8492c1abace5fe72785cd80189aa4c64d7652dff38490&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;Gateway&quot;</span>: <span class="string">&quot;172.17.0.1&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;IPAddress&quot;</span>: <span class="string">&quot;172.17.0.2&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;IPPrefixLen&quot;</span>: <span class="number">16</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">&quot;HostConfig&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;NetworkMode&quot;</span>: <span class="string">&quot;default&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">&quot;Status&quot;</span>: <span class="string">&quot;Up 11 minutes&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;State&quot;</span>: <span class="string">&quot;running&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;Id&quot;</span>: <span class="string">&quot;919b34a2201822a04fb1160c1c2369580d7b9ef9e7f1e9c77ad4da8761649fb9&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;Names&quot;</span>: [</span><br><span class="line">      <span class="string">&quot;/mynginx&quot;</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">&quot;Image&quot;</span>: <span class="string">&quot;nginx&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;ImageID&quot;</span>: <span class="string">&quot;sha256:f35646e83998b844c3f067e5a2cff84cdf0967627031aeda3042d78996b68d35&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;Command&quot;</span>: <span class="string">&quot;/docker-entrypoint.sh nginx -g &#x27;daemon off;&#x27;&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;Created&quot;</span>: <span class="number">1603879410</span>,</span><br><span class="line">    <span class="attr">&quot;Ports&quot;</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">&quot;Type&quot;</span>: <span class="string">&quot;tcp&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;PublicPort&quot;</span>: <span class="number">80</span>,</span><br><span class="line">        <span class="attr">&quot;PrivatePort&quot;</span>: <span class="number">80</span>,</span><br><span class="line">        <span class="attr">&quot;IP&quot;</span>: <span class="string">&quot;0.0.0.0&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">&quot;Labels&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;maintainer&quot;</span>: <span class="string">&quot;NGINX Docker Maintainers &lt;docker-maint@nginx.com&gt;&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">]</span><br><span class="line"></span><br></pre></td></tr></table></figure>

</li>
</ul>
<p>如果去看看 Engine API，你会发现其它的请求也都是用类似方式发送的，更多API可以参考官方文档，目前最新的版本是v1.40：<a target="_blank" rel="noopener" href="https://docs.docker.com/engine/api/v1.40/">https://docs.docker.com/engine/api/v1.40/</a></p>
<p>至此，我们对docker的client、server架构有了清楚的认识：Docker Daemon相当于一个server，监听来自/var/run/docker.sock的请求，然后做出各种响应，例如返回镜像列表，创建容器。</p>
<p>更多精彩内容：<a href="https://blog.mrxccc.cn/">mrxccc</a></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:mrxccc@qq.com">mrxccc</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://blog.mrxccc.cn/posts/4d3646a8.html">https://blog.mrxccc.cn/posts/4d3646a8.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://blog.mrxccc.cn" target="_blank">小C的博客</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/186d0ab9.html"><img class="prev-cover" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">docker系列-docker远程访问</div></div></a></div><div class="next-post pull-right"><a href="/posts/89a20157.html"><img class="next-cover" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">设计模式-工厂方法模式</div></div></a></div></nav><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div></div><div class="aside_content" id="aside_content"><div class="card-widget card-info"><div class="card-content"><div class="card-info-avatar is-center"><img class="avatar-img" src="/null" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-info__name">mrxccc</div><div class="author-info__description"></div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">19</div></a></div><div class="card-info-data-item is-center"><a href="/categories/"><div class="headline">分类</div><div class="length-num">6</div></a></div></div><a class="button--animated" id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/mrxccc"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/mrxccc" target="_blank" title="Github"><i class="fab fa-github"></i></a></div></div></div><div class="card-widget card-announcement"><div class="card-content"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>公告</span></div><div class="announcement_content">小C的博客</div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="card-content"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%A2%84%E5%A4%87%E7%9F%A5%E8%AF%86"><span class="toc-text">预备知识</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Docker-%E7%9A%84%E4%B8%BB%E8%A6%81%E7%BB%84%E4%BB%B6"><span class="toc-text">Docker 的主要组件</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BB%8E-hello-world-%E5%BC%80%E5%A7%8B"><span class="toc-text">从 hello world 开始</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%BF%9B%E5%85%A5%E6%AD%A3%E9%A2%98"><span class="toc-text">进入正题</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Docker-Daemon-%E7%9A%84%E8%BF%9E%E6%8E%A5%E6%96%B9%E5%BC%8F"><span class="toc-text">Docker Daemon 的连接方式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AFunix-socket%EF%BC%9F"><span class="toc-text">什么是unix socket？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%98%E6%96%B9%E8%AF%B4%E6%98%8E"><span class="toc-text">官方说明</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%AA%8C%E8%AF%81"><span class="toc-text">验证</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E6%9F%A5%E7%9C%8B%E9%95%9C%E5%83%8F%EF%BC%9A"><span class="toc-text">1.查看镜像：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E6%9F%A5%E7%9C%8B%E5%AE%B9%E5%99%A8%EF%BC%9A"><span class="toc-text">2.查看容器：</span></a></li></ol></li></ol></li></ol></div></div></div><div class="card-widget card-recent-post"><div class="card-content"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/2a48474d.html" title="设计模式-建造者模式">设计模式-建造者模式</a><time datetime="2020-11-24T06:09:03.000Z" title="发表于 2020-11-24 14:09:03">2020-11-24</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/2fab00f3.html" title="从服务化到云原生-配置">从服务化到云原生-配置</a><time datetime="2020-11-23T07:38:59.000Z" title="发表于 2020-11-23 15:38:59">2020-11-23</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/5a86ebac.html" title="设计模式-抽象工厂模式">设计模式-抽象工厂模式</a><time datetime="2020-11-21T02:33:12.000Z" title="发表于 2020-11-21 10:33:12">2020-11-21</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/52649bb.html" title="Gitlab Runner的安装与配置">Gitlab Runner的安装与配置</a><time datetime="2020-11-03T04:57:44.000Z" title="发表于 2020-11-03 12:57:44">2020-11-03</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/7a7080f.html" title="Gitlab-runner的容器化安装与使用">Gitlab-runner的容器化安装与使用</a><time datetime="2020-11-03T04:57:44.000Z" title="发表于 2020-11-03 12:57:44">2020-11-03</time></div></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 By mrxccc</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">簡</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><div class="js-pjax"><script>function loadValine () {
  function initValine () {
    let initData = {
      el: '#vcomment',
      appId: 'pBTWg7eYLYg9sKO5yF1x4PmQ-gzGzoHsz',
      appKey: 'DWJf0aAaDtJI730OGTGxo3hX',
      placeholder: '邮件地址不会被公开',
      avatar: 'monsterid',
      meta: 'nick,mail,link'.split(','),
      pageSize: '10',
      lang: 'en',
      recordIP: false,
      serverURLs: '',
      emojiCDN: '',
      emojiMaps: "",
      enableQQ: true,
      path: window.location.pathname,
    }

    if (true) { 
      initData.requiredFields= ('nick,mail'.split(','))
    }
    
    if (false) {
      const otherData = false
      initData = Object.assign({}, initData, otherData)
    }
    
    const valine = new Valine(initData)
  }

  if (typeof Valine === 'function') initValine() 
  else $.getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js', initValine)
}

if ('Valine' === 'Valine' || !true) {
  if (true) btf.loadComment(document.querySelector('#vcomment'),loadValine)
  else setTimeout(() => loadValine(), 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-nest.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script id="click-heart" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/click-heart.min.js" async="async" mobile="false"></script><script>(function(){
  const bp = document.createElement('script');
  const curProtocol = window.location.protocol.split(':')[0];
  if (curProtocol === 'https'){
  bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
  }
  else{
  bp.src = 'http://push.zhanzhang.baidu.com/push.js';
  }
  bp.dataset.pjax = ''
  const s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(bp, s);
})()</script></div></body></html>